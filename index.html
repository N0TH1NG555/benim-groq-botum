<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.S.C.A Ai | Advanced System</title>
    
    <!-- Favicon (Siyah Zemin Üzerine Beyaz Benzen Halkası) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23000000%22/><text y=%22.9em%22 x=%2250%22 text-anchor=%22middle%22 font-size=%2280%22 fill=%22%23ffffff%22>⌬</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Highlight.js (Github Dark - Siyah Tema) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <!-- Google Fonts: Space Grotesk (Başlıklar) & JetBrains Mono (Kod/Terminal) -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Space Grotesk', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        asca: {
                            black: '#000000',
                            dark: '#09090b',
                            border: '#27272a',
                            text: '#fafafa',
                            silver: '#a1a1aa'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'spin-slow': 'spin 15s linear infinite',
                        'glitch': 'glitch 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #000000;
            /* Tech Grid Background */
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            color: #fafafa;
        }

        /* Minimal Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #000; 
        }
        ::-webkit-scrollbar-thumb {
            background: #333; 
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #fff; 
        }

        /* Message Styles - High Contrast */
        .msg-user {
            background: #ffffff;
            color: #000000;
            border-radius: 2px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
            font-weight: 500;
        }
        
        .msg-ai {
            background: #09090b;
            color: #e4e4e7;
            border: 1px solid #27272a;
            border-left: 2px solid #ffffff;
            border-radius: 2px;
        }

        /* Typing Animation */
        .typing-dot {
            width: 4px;
            height: 4px;
            background-color: #fff;
            display: inline-block;
            margin: 0 1px;
            animation: bounce 1s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(-4px); opacity: 1; }
        }

        /* Markdown Overrides */
        .prose pre {
            background: #000000 !important;
            border: 1px solid #333;
            border-radius: 0;
        }
        .prose code {
            font-family: 'JetBrains Mono', monospace;
            color: #d4d4d8;
        }
        .prose strong { color: #fff; font-weight: 700; }
        .prose a { color: #fff; text-decoration: underline; text-underline-offset: 4px; }
        .prose ul > li::marker { color: #666; }

        /* Status Indicators */
        .status-dot {
            width: 6px;
            height: 6px;
            background: #333;
            border-radius: 50%;
            transition: all 0.3s;
        }
        .status-dot.active { background: #fff; box-shadow: 0 0 8px #fff; }
        .status-dot.error { background: #ef4444; }
        .status-dot.loading { background: #eab308; animation: pulse 1s infinite; }
    </style>
</head>
<body class="h-screen flex flex-col font-sans overflow-hidden selection:bg-white selection:text-black">

    <!-- Header -->
    <header class="h-20 border-b border-white/10 bg-black/90 backdrop-blur-md flex items-center justify-between px-6 z-20">
        <div class="flex items-center gap-5">
            <!-- Logo Area -->
            <div class="relative group">
                <div class="absolute -inset-1 bg-white/20 rounded-full blur opacity-0 group-hover:opacity-100 transition duration-500"></div>
                <div class="w-12 h-12 border border-white/20 bg-black flex items-center justify-center relative z-10">
                    <span class="text-3xl text-white font-mono leading-none pb-1 animate-spin-slow" style="animation-duration: 20s;">⌬</span>
                </div>
            </div>
            
            <!-- Title Area -->
            <div class="flex flex-col justify-center">
                <h1 class="text-2xl font-bold tracking-[0.2em] text-white font-mono leading-none mb-1">A.S.C.A</h1>
                <div class="flex items-center gap-2">
                    <span id="connection-dot" class="status-dot"></span>
                    <span id="connection-text" class="text-[10px] text-zinc-500 uppercase tracking-widest font-mono">SYSTEM OFFLINE</span>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-6">
            <a href="#" onclick="clearChat()" class="group flex items-center gap-2 text-zinc-600 hover:text-white transition-colors">
                <span class="text-[10px] font-mono uppercase tracking-widest hidden sm:block group-hover:tracking-[0.2em] transition-all">TERMINATE SESSION</span>
                <i class="fa-solid fa-power-off text-xs group-hover:text-red-500 transition-colors"></i>
            </a>
        </div>
    </header>

    <!-- Main Chat Area -->
    <main class="flex-1 overflow-hidden relative flex flex-col bg-black">
        <!-- Messages Container -->
        <div id="chat-container" class="flex-1 overflow-y-auto p-4 sm:p-8 space-y-8 scroll-smooth relative z-10">
            
            <!-- Welcome Screen -->
            <div id="welcome-screen" class="flex flex-col items-center justify-center h-full text-center space-y-8 opacity-0 animate-fade-in" style="animation-delay: 0.2s;">
                <div class="relative">
                    <div class="absolute inset-0 bg-white blur-[80px] opacity-5"></div>
                    <div class="text-8xl text-white opacity-10 animate-pulse font-mono">⌬</div>
                </div>
                
                <div class="space-y-2">
                    <h2 class="text-4xl sm:text-5xl font-bold text-white tracking-tighter">A.S.C.A <span class="text-zinc-700 font-mono text-2xl">V.3.3</span></h2>
                    <p class="text-zinc-500 font-mono text-xs uppercase tracking-[0.3em]">Advanced System for Computational Assistance</p>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-2xl mt-8">
                    <button onclick="setInput('Sistem ne alemde bak bakalım kanka.')" class="group p-6 border border-zinc-800 bg-zinc-950 hover:bg-white hover:border-white transition-all duration-300 text-left relative overflow-hidden">
                        <div class="absolute inset-0 bg-white translate-y-full group-hover:translate-y-0 transition-transform duration-300 z-0"></div>
                        <div class="relative z-10 group-hover:text-black">
                            <div class="flex justify-between items-start mb-2">
                                <i class="fa-solid fa-terminal text-zinc-600 group-hover:text-black"></i>
                                <span class="text-[10px] font-mono border border-zinc-800 px-1 group-hover:border-black">INIT_SEQ_01</span>
                            </div>
                            <span class="block text-sm font-bold tracking-wide font-mono">DURUM ANALİZİ YAP</span>
                        </div>
                    </button>
                    
                    <button onclick="setInput('Bana kuantum olayını şöyle ortaya karışık anlatsana.')" class="group p-6 border border-zinc-800 bg-zinc-950 hover:bg-white hover:border-white transition-all duration-300 text-left relative overflow-hidden">
                        <div class="absolute inset-0 bg-white translate-y-full group-hover:translate-y-0 transition-transform duration-300 z-0"></div>
                        <div class="relative z-10 group-hover:text-black">
                            <div class="flex justify-between items-start mb-2">
                                <i class="fa-solid fa-database text-zinc-600 group-hover:text-black"></i>
                                <span class="text-[10px] font-mono border border-zinc-800 px-1 group-hover:border-black">DATA_REQ_02</span>
                            </div>
                            <span class="block text-sm font-bold tracking-wide font-mono">BİLGİ VER BAKALIM</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 sm:p-6 bg-gradient-to-t from-black via-black to-transparent z-20 relative">
            <div class="max-w-4xl mx-auto">
                <div class="relative flex items-end bg-black border border-zinc-800 hover:border-zinc-600 transition-colors group">
                    <!-- Console Prefix -->
                    <div class="pl-4 py-4 flex h-full items-center select-none">
                         <span class="text-zinc-500 font-mono text-xs animate-pulse">root@asca:~#</span>
                    </div>
                    
                    <textarea 
                        id="user-input" 
                        rows="1"
                        placeholder="Bir şeyler yaz kanka..." 
                        class="w-full bg-transparent text-white placeholder-zinc-800 text-sm font-mono p-4 focus:outline-none resize-none max-h-48"
                        oninput="autoResize(this)"
                        onkeydown="handleEnter(event)"
                    ></textarea>
                    
                    <div class="p-2 flex items-end">
                        <button 
                            id="send-btn" 
                            onclick="sendMessage()"
                            class="w-10 h-10 bg-white text-black hover:bg-zinc-300 flex items-center justify-center transition-all disabled:opacity-20 disabled:cursor-not-allowed"
                        >
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="flex justify-between mt-2 px-1">
                    <p class="text-[9px] text-zinc-700 font-mono uppercase tracking-widest">ENCRYPTED CONNECTION</p>
                    <p class="text-[9px] text-zinc-700 font-mono uppercase">LLAMA-3.3 // 70B</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- API & BAĞLANTI AYARLARI ---
        const CONFIG = {
            apiKey: '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',
            model: 'llama-3.3-70b-versatile',
            endpoints: [
                { url: 'https://api.groq.com/openai/v1/chat/completions', name: 'DIRECT' },
                { url: 'https://corsproxy.io/?https://api.groq.com/openai/v1/chat/completions', name: 'PROXY_01' },
                { url: 'https://cors-anywhere.herokuapp.com/https://api.groq.com/openai/v1/chat/completions', name: 'PROXY_02' },
                { url: 'https://thingproxy.freeboard.io/fetch/https://api.groq.com/openai/v1/chat/completions', name: 'PROXY_03' }
            ]
        };

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const welcomeScreen = document.getElementById('welcome-screen');
        const statusDot = document.getElementById('connection-dot');
        const statusText = document.getElementById('connection-text');

        let messageHistory = [
            { role: "system", content: "Sen A.S.C.A adında gelişmiş bir yapay zekasın ama tam bir 'Türk işi' teknoloji uzmanı, mahallenin bilgisayarcı abisi gibi davranıyorsun. Aşırı samimi, esprili ve 'bizden' biri gibi konuş. 'Kanka', 'Hocam', 'Güzel kardeşim', 'Reis', 'Bak şimdi' gibi hitapları bolca kullan. Teknik bilgileri verirken araya 'Hallederiz', 'Sıkıntı yok', 'Aynen öyle', 'Mevzu derin' gibi laflar sıkıştır. Mizah yapmaktan çekinme ama sorunun cevabını da net ver. Robotik konuşma, samimi ol. Markdown formatını kullan." }
        ];

        let isGenerating = false;

        // --- GÜNCELLEME: Sayfa yüklendiğinde durumu güncelle ---
        window.onload = () => {
            updateStatus('SYSTEM READY', 'active');
        };

        async function fetchWithFallback(payload) {
            let lastError;
            
            for (const endpoint of CONFIG.endpoints) {
                try {
                    updateStatus(`CONNECTING: ${endpoint.name}...`, 'loading');
                    
                    const response = await fetch(endpoint.url, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${CONFIG.apiKey}`,
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        credentials: 'omit',
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 401) throw new Error("AUTH_FAIL: API KEY INVALID");
                        if (response.status === 403) throw new Error("ACCESS_DENIED: PROXY LIMIT");
                        throw new Error(`HTTP_ERR: ${response.status}`);
                    }

                    const data = await response.json();
                    updateStatus('DATA RECEIVED', 'active');
                    return data; 

                } catch (error) {
                    console.warn(`${endpoint.name} failed:`, error.message);
                    lastError = error;
                }
            }
            
            updateStatus('CONNECTION FAILED', 'error');
            throw lastError || new Error("ALL NODES FAILED");
        }

        function updateStatus(text, type) {
            statusText.textContent = text;
            statusDot.className = 'status-dot'; // reset
            if (type === 'active') statusDot.classList.add('active');
            if (type === 'error') statusDot.classList.add('error');
            if (type === 'loading') statusDot.classList.add('loading');
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
        }

        function handleEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function setInput(text) {
            userInput.value = text;
            autoResize(userInput);
            userInput.focus();
        }

        function scrollToBottom() {
            chatContainer.scrollTo({
                top: chatContainer.scrollHeight,
                behavior: 'smooth'
            });
        }

        function createMessageElement(content, role) {
            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = `flex w-full ${role === 'user' ? 'justify-end' : 'justify-start'} animate-slide-up`;
            
            // AI Icon for messages
            const avatar = role === 'ai' 
                ? `<div class="w-8 h-8 border border-zinc-800 bg-black flex-shrink-0 flex items-center justify-center mr-3 mt-1"><span class="text-white text-lg leading-none pb-1">⌬</span></div>`
                : '';

            const msgDiv = document.createElement('div');
            msgDiv.className = `max-w-[85%] sm:max-w-[75%] p-4 text-sm sm:text-base leading-relaxed overflow-hidden ${role === 'user' ? 'msg-user' : 'msg-ai text-gray-200 prose prose-invert max-w-none'}`;

            if (role === 'ai') {
                msgDiv.innerHTML = marked.parse(content);
                msgDiv.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            } else {
                msgDiv.textContent = content;
            }

            wrapperDiv.innerHTML = role === 'ai' ? avatar : '';
            wrapperDiv.appendChild(msgDiv);
            
            return wrapperDiv;
        }

        function showTypingIndicator() {
            const wrapperDiv = document.createElement('div');
            wrapperDiv.id = 'typing-indicator';
            wrapperDiv.className = 'flex w-full justify-start animate-fade-in';
            wrapperDiv.innerHTML = `
                <div class="w-8 h-8 border border-zinc-800 bg-black flex-shrink-0 flex items-center justify-center mr-3 mt-1">
                    <span class="text-white text-lg leading-none pb-1">⌬</span>
                </div>
                <div class="msg-ai px-4 py-3 flex items-center gap-1">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatContainer.appendChild(wrapperDiv);
            scrollToBottom();
            return wrapperDiv;
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text || isGenerating) return;

            if (welcomeScreen) welcomeScreen.style.display = 'none';
            userInput.value = '';
            userInput.style.height = 'auto';
            isGenerating = true;
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

            chatContainer.appendChild(createMessageElement(text, 'user'));
            scrollToBottom();
            messageHistory.push({ role: "user", content: text });

            const typingIndicator = showTypingIndicator();

            try {
                const data = await fetchWithFallback({
                    model: CONFIG.model,
                    messages: messageHistory,
                    temperature: 0.7,
                    max_tokens: 2048
                });

                const aiResponse = data.choices[0].message.content;
                typingIndicator.remove();

                chatContainer.appendChild(createMessageElement(aiResponse, 'ai'));
                messageHistory.push({ role: "assistant", content: aiResponse });

            } catch (error) {
                typingIndicator.remove();
                
                let errorMsg = `<strong>SYSTEM ALERT:</strong><br>${error.message}<br><br>
                <em>RECOVERY PROTOCOLS:</em><br>
                1. <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank" class="text-white underline font-bold">GRANT ACCESS PERMISSION</a><br>
                2. REFRESH SYSTEM (F5)<br>
                3. DISABLE FIREWALL/ADBLOCK`;

                const errorDiv = document.createElement('div');
                errorDiv.className = 'w-full flex justify-center my-4';
                errorDiv.innerHTML = `<div class="bg-red-900/10 border border-red-900/50 text-red-500 px-6 py-4 font-mono text-xs shadow-lg max-w-md">${errorMsg}</div>`;
                chatContainer.appendChild(errorDiv);
            } finally {
                isGenerating = false;
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<i class="fa-solid fa-arrow-right"></i>';
                scrollToBottom();
                userInput.focus();
            }
        }

        function clearChat() {
            location.reload();
        }

        marked.setOptions({
            breaks: true, 
            gfm: true
        });
    </script>
</body>
</html>
